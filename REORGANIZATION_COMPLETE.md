# ‚úÖ –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. üìÅ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### **Data/MultiFile/** - —Ç–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (4 —Ñ–∞–π–ª–∞)
- ‚úÖ `01_types_and_domains.sql` - 2 ENUMs, 2 Composites, 4 Domains + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- ‚úÖ `02_tables.sql` - 4 —Ç–∞–±–ª–∏—Ü—ã (users, categories, orders, order_items) + FK
- ‚úÖ `03_indexes.sql` - 15+ –∏–Ω–¥–µ–∫—Å–æ–≤ (B-tree, GIN, GIST)
- ‚úÖ `04_functions_and_triggers.sql` - 3 —Ñ—É–Ω–∫—Ü–∏–∏ + 4 —Ç—Ä–∏–≥–≥–µ—Ä–∞

#### **Data/EdgeCases/** - –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (4 —Ñ–∞–π–ª–∞)
- ‚úÖ `EmptyFile.sql` - –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- ‚úÖ `OnlyComments.sql` - —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –±–µ–∑ SQL
- ‚úÖ `InvalidSyntax.sql` - —Ñ–∞–π–ª —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏
- ‚úÖ `SpecialCharacters.sql` - –∫–∏—Ä–∏–ª–ª–∏—Ü–∞, emoji, unicode, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã

### 2. üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ

- ‚ùå **Data/SepatatedFiles/** (16 —Ñ–∞–π–ª–æ–≤) - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏ unit-—Ç–µ—Å—Ç—ã
- ‚ùå –í—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `.csproj` —Ñ–∞–π–ª–∞

### 3. üß™ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**SchemaAnalyzerIntegrationTests.cs** - —Ç–µ–ø–µ—Ä—å 5 —Ç–µ—Å—Ç–æ–≤:

1. ‚úÖ `AnalyzeFullSchema_ExtractsAllObjectsCorrectly()` - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞
2. ‚úÖ `AnalyzeMultipleFiles_ExtractsAllObjectsCorrectly()` - –Ω–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è MultiFile
3. ‚úÖ `AnalyzeEdgeCases_HandlesGracefully()` - –Ω–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è EdgeCases
4. ‚úÖ `AnalyzeFullSchema_CompletesInReasonableTime()` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
5. ‚úÖ `AnalyzeFullSchema_MaintainsObjectRelationships()` - —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å–≤—è–∑–µ–π

### 4. üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω SchemaAnalyzer.cs

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤:

```csharp
// –í AnalyzeFileAsync()
if (string.IsNullOrWhiteSpace(sqlContent))
{
    return CreateEmptyMetadata([schemaFilePath], schemaFilePath);
}

// –í AnalyzeDirectoryAsync()
if (string.IsNullOrWhiteSpace(sqlContent))
{
    sourcePaths.Add(filePath);
    continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
}
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç `ArgumentException` –æ—Ç `BlockParser.Parse()` –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–∞—Ö.

### 5. üìù –û–±–Ω–æ–≤–ª–µ–Ω .csproj —Ñ–∞–π–ª

–ó–∞–º–µ–Ω–µ–Ω—ã —è–≤–Ω—ã–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ wildcards:

```xml
<!-- –°—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: 50+ —Å—Ç—Ä–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ -->
<None Update="Data\SepatatedFiles\CreateTable.sql">...</None>
<None Update="Data\SepatatedFiles\CreateEnum.sql">...</None>
...

<!-- –ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: 3 —Å—Ç—Ä–æ–∫–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ -->
<None Update="Data\MultiFile\*.sql">
  <CopyToOutputDirectory>Always</CopyToOutputDirectory>
</None>
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ ‚Üí –ü–æ—Å–ª–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|--------|-----------|
| **–¢–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | 17 | 9 | ‚úÖ -47% |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** | 4 | 5 | ‚úÖ +25% |
| **–°—Ç—Ä–æ–∫ –≤ .csproj** | ~80 | ~20 | ‚úÖ -75% |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | –î–∞ | –ù–µ—Ç | ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ |
| **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏** | –ù–µ—Ç | –ï—Å—Ç—å | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤** | –û—à–∏–±–∫–∞ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

## üéØ –£–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**Unit-—Ç–µ—Å—Ç—ã** (–¥–µ—Ç–∞–ª–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞):
- `TableExtractorTests` - –ø–∞—Ä—Å–∏–Ω–≥ CREATE TABLE
- `FunctionExtractorTests` - –ø–∞—Ä—Å–∏–Ω–≥ CREATE FUNCTION
- `EnumExtractorTests` - –ø–∞—Ä—Å–∏–Ω–≥ CREATE TYPE
- –ò –¥—Ä—É–≥–∏–µ 10+ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (—Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏):
1. **–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞** - –≤–µ—Å—å —Ñ–∞–π–ª Schema.sql —Ü–µ–ª–∏–∫–æ–º
2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** - —Ç–∏–ø–æ–≤–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏** - —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º

### –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

‚úÖ **–í—Å–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ PostgreSQL:**
- ENUMs, Composites, Domains
- Tables (—Å inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)
- Views (–æ–±—ã—á–Ω—ã–µ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
- Functions, Triggers
- Indexes (B-tree, GIN, GIST)
- Partitions (RANGE)
- Comments (COMMENT ON)
- Constraints (FK, CHECK)

‚úÖ **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- –ü—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã
- –§–∞–π–ª—ã —Ç–æ–ª—å–∫–æ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏ (FK)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üìÇ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
tests/PgCs.SchemaAnalyzer.Tante.Tests/
‚îú‚îÄ‚îÄ Data/
‚îÇ   ‚îú‚îÄ‚îÄ FullSchema/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Schema.sql (–ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ ~1000 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ MultiFile/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01_types_and_domains.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02_tables.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03_indexes.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 04_functions_and_triggers.sql
‚îÇ   ‚îî‚îÄ‚îÄ EdgeCases/
‚îÇ       ‚îú‚îÄ‚îÄ EmptyFile.sql
‚îÇ       ‚îú‚îÄ‚îÄ OnlyComments.sql
‚îÇ       ‚îú‚îÄ‚îÄ InvalidSyntax.sql
‚îÇ       ‚îî‚îÄ‚îÄ SpecialCharacters.sql
‚îú‚îÄ‚îÄ Integration/
‚îÇ   ‚îî‚îÄ‚îÄ SchemaAnalyzerIntegrationTests.cs (5 —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ Unit/
‚îÇ   ‚îú‚îÄ‚îÄ TableExtractorTests.cs
‚îÇ   ‚îú‚îÄ‚îÄ FunctionExtractorTests.cs
‚îÇ   ‚îî‚îÄ‚îÄ ... (10+ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤)
‚îî‚îÄ‚îÄ PgCs.SchemaAnalyzer.Tante.Tests.csproj
```

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
dotnet test tests/PgCs.SchemaAnalyzer.Tante.Tests/

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
dotnet test tests/PgCs.SchemaAnalyzer.Tante.Tests/ \
  --filter "FullyQualifiedName~SchemaAnalyzerIntegrationTests"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
dotnet test tests/PgCs.SchemaAnalyzer.Tante.Tests/ \
  --filter "AnalyzeMultipleFiles"

# –° –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
dotnet test tests/PgCs.SchemaAnalyzer.Tante.Tests/ --verbosity normal
```

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ –§–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ bin/Debug/net9.0/Data/
- ‚úÖ SchemaAnalyzer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ .csproj —É–ø—Ä–æ—â—ë–Ω —Å wildcards
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å:**
- –ß–∏—â–µ (–º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
- –ü–æ–Ω—è—Ç–Ω–µ–µ (—á—ë—Ç–∫–∏–µ —É—Ä–æ–≤–Ω–∏)
- –ù–∞–¥—ë–∂–Ω–µ–µ (–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏)
- –ü—Ä–æ—â–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ (wildcards –≤ .csproj)

---

*–î–∞—Ç–∞: 6 –Ω–æ—è–±—Ä—è 2025*
*–ü—Ä–æ–µ–∫—Ç: PgCs (PostgreSQL to C# Schema Generator)*

