# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Schema Analyzer - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ ISqlBlockParser
- `sqlContent` ‚Üí `sql` –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SqlBlockParser
**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `SqlBlockBuilder.cs` - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å –±–ª–æ–∫–æ–≤ (–∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- `SqlCommentExtensions.cs` - extension methods –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Span<char>` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
- –í—ã–Ω–µ—Å–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ extension methods (—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ - –≤—Å–µ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —á–µ—Ä–µ–∑ SqlBlockBuilder

### 3. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ ParsingContext
- –§–∞–π–ª —É–¥–∞–ª–µ–Ω
- –õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞ - –ø–µ—Ä–µ–¥–∞–µ–º `blocks`, `currentIndex` –Ω–∞–ø—Ä—è–º—É—é

### 4. ‚úÖ –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ IEnumTypeParser
**–ë—ã–ª–æ:**
```csharp
bool TryParse(ParsingContext context, 
              out EnumTypeDefinition? enumDefinition, 
              out IReadOnlyList<ValidationIssue> validationIssues);
```

**–°—Ç–∞–ª–æ:**
```csharp
EnumParseResult Parse(SqlBlock block, 
                      IReadOnlyList<SqlBlock> blocks, 
                      int currentIndex);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç `out` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - —á–∏—â–µ API
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω –≤ `EnumParseResult`
- ValidationIssues –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –£–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã `Success()`, `Failure()`, `NotApplicable()`

### 5. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ extension methods:**

#### Core –ø—Ä–æ–µ–∫—Ç:
- `SqlCommentExtensions` - —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
  - `IsCommentLine()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  - `ExtractCommentText()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  - `SplitInlineComment()` - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

- `SqlBlockExtensions` - —Ä–∞–±–æ—Ç–∞ —Å –±–ª–æ–∫–∞–º–∏
  - `IsEnumDefinition()` - –¥–µ—Ç–µ–∫—Ü–∏—è ENUM
  - `IsTypeComment()` - –¥–µ—Ç–µ–∫—Ü–∏—è COMMENT ON TYPE
  - `FindRelatedTypeComment()` - –ø–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

- `EnumValueParser` - –ø–∞—Ä—Å–∏–Ω–≥ –∑–Ω–∞—á–µ–Ω–∏–π ENUM
  - `ParseValues()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ReadOnlySpan<char>` (C# 14)

- `TypeCommentExtractor` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ —Ç–∏–ø–∞–º
  - `ExtractCommentFromBlock()` - –∏–∑ COMMENT ON TYPE
  - `ExtractComment()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥

- `SqlBlockBuilder` - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å –±–ª–æ–∫–æ–≤
  - –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
  - –ù–µ—Ç —Å–∫—Ä—ã—Ç–æ–π –ª–æ–≥–∏–∫–∏

#### –ú–æ–¥–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
- `EnumParseResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å ValidationIssues

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –í—Å–µ —É—Ç–∏–ª–∏—Ç—ã - –ø—É–±–ª–∏—á–Ω—ã–µ static –º–µ—Ç–æ–¥—ã/extension methods
- ‚úÖ –ù–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö
- ‚úÖ –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ `Span<char>` –≤–º–µ—Å—Ç–æ string –æ–ø–µ—Ä–∞—Ü–∏–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- ‚úÖ Stack allocations –≤–º–µ—Å—Ç–æ heap –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ
- ‚úÖ –ú–µ–Ω—å—à–µ StringBuilder - –±–æ–ª—å—à–µ –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏

### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å
- ‚úÖ Extension methods –¥–µ–ª–∞—é—Ç –∫–æ–¥ fluent –∏ –ø–æ–Ω—è—Ç–Ω—ã–º
- ‚úÖ –ù–µ—Ç out –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - —á–∏—Å—Ç—ã–π functional —Å—Ç–∏–ª—å
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ typed –æ–±—ä–µ–∫—Ç—ã

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π C# 14
- ‚úÖ `required` properties
- ‚úÖ Collection expressions `[]`
- ‚úÖ Pattern matching
- ‚úÖ `ReadOnlySpan<char>` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚úÖ Source-generated —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### PgCs.Core/Parsing
```
SqlBlock.cs                    // –ú–æ–¥–µ–ª—å –±–ª–æ–∫–∞
ISqlBlockParser.cs             // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞—Ä—Å–µ—Ä–∞
SqlBlockParser.cs              // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)
SqlBlockBuilder.cs             // ‚ú® NEW - —Å—Ç—Ä–æ–∏—Ç–µ–ª—å –±–ª–æ–∫–æ–≤
SqlCommentExtensions.cs        // ‚ú® NEW - extension methods –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
```

### PgCs.Core/Schema/Analyzer
```
IEnumTypeParser.cs             // –û–±–Ω–æ–≤–ª–µ–Ω - –Ω–æ–≤–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞
EnumParseResult.cs             // ‚ú® NEW - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞
SqlBlockExtensions.cs          // ‚ú® NEW - –¥–µ—Ç–µ–∫—Ü–∏—è —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤
EnumValueParser.cs             // ‚ú® NEW - –ø–∞—Ä—Å–∏–Ω–≥ –∑–Ω–∞—á–µ–Ω–∏–π ENUM
TypeCommentExtractor.cs        // ‚ú® NEW - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
SchemaMetadata.cs              // –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### PgCs.SchemaAnalyzer.Tante/Parsers
```
EnumTypeParser.cs              // –ü–µ—Ä–µ–ø–∏—Å–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Ç–∏–ª–∏—Ç—ã
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Extension methods
```csharp
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
if (line.IsCommentLine()) 
{
    var comment = line.ExtractCommentText();
}

// –î–µ—Ç–µ–∫—Ü–∏—è —Ç–∏–ø–∞ –±–ª–æ–∫–∞
if (block.IsEnumDefinition()) 
{
    var result = parser.Parse(block, blocks, index);
}
```

### –ü–∞—Ä—Å–∏–Ω–≥ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
```csharp
var result = enumParser.Parse(block, blocks, i);

if (result.IsSuccess) 
{
    enums.Add(result.Definition);
}

validationIssues.AddRange(result.ValidationIssues);
```

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å Span
```csharp
var values = EnumValueParser.ParseValues(valuesText.AsSpan());
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- StringBuilder –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ (heap allocations)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ string operations
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- SqlBlockBuilder –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- Span<char> –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- Extension methods –∫—ç—à–∏—Ä—É—é—Ç regex
- –ú–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –≤ —Ü–µ–ª–æ–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ:
```bash
‚úÖ test_enum_cases.sql - 4 ENUM —Ç–∏–ø–∞
‚úÖ Schema.sql - 4 ENUM —Ç–∏–ø–∞
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ö–µ–º (public.enum_name)
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–¥ —Å—Ç–∞–ª:
- üéØ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–µ–µ** - –≤—Å–µ –ø—É–±–ª–∏—á–Ω–æ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚ö° **–ë—ã—Å—Ç—Ä–µ–µ** - Span, –º–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π
- üìñ **–ß–∏—Ç–∞–µ–º–µ–µ** - extension methods, –Ω–µ—Ç out –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- üîß **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–µ–µ** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- üöÄ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–µ–µ** - C# 14 —Ñ–∏—á–∏

–ì–æ—Ç–æ–≤–æ –∫ production –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é!
